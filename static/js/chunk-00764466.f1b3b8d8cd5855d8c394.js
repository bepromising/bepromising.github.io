(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-00764466"],{"2f21":function(e,t,l){"use strict";var a=l("79e5");e.exports=function(e,t){return!!e&&a(function(){t?e.call(null,function(){},1):e.call(null)})}},"386d":function(e,t,l){l("214f")("search",1,function(e,t,l){return[function(l){"use strict";var a=e(this),o=void 0==l?void 0:l[t];return void 0!==o?o.call(l,a):new RegExp(l)[t](String(a))},l]})},4917:function(e,t,l){l("214f")("match",1,function(e,t,l){return[function(l){"use strict";var a=e(this),o=void 0==l?void 0:l[t];return void 0!==o?o.call(l,a):new RegExp(l)[t](String(a))},l]})},"55dd":function(e,t,l){"use strict";var a=l("5ca1"),o=l("d8e8"),r=l("4bf8"),s=l("79e5"),i=[].sort,n=[1,2,3];a(a.P+a.F*(s(function(){n.sort(void 0)})||!s(function(){n.sort(null)})||!l("2f21")(i)),"Array",{sort:function(e){return void 0===e?i.call(r(this)):i.call(r(this),o(e))}})},bedf:function(e,t,l){"use strict";l.d(t,"a",function(){return a}),l.d(t,"b",function(){return s}),l.d(t,"c",function(){return r}),l.d(t,"d",function(){return o});l("a481"),l("4917"),l("f751");var a=function(e){var t=JSON.stringify(e);return JSON.parse(t)},o=function e(t){for(var l,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"0",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"parentId",r=[],s=0,i=t.length;s<i;s++)if(t[s][o]==a){var n=t[s];l=e(t,t[s].id,o),l.length>0&&(n.children=l),r.push(n)}return r},r=function e(t,l,a){for(var o,r=[],s=Object.assign({parentKey:"parentId",idKey:"id",childrenKey:"children"},l),i=0,n=t.length;i<n;i++)if(t[i][s.parentKey]==a){var c={};for(var d in s.map)c[s.map[d]]=t[i][d];o=e(t,l,t[i][s.idKey]),o.length>0&&(c[s.childrenKey]=o),r.push(c)}return r},s=function(e,t){var l=/\$\{\w+\}/,a=e.match(l);while(a){var o=a[0],r=t[o.replace(/\$\{(\w+)\}/,"$1")];e=e.replace(o,r),a=e.match(l)}return e}},f982:function(e,t,l){"use strict";l.r(t);var a=function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("section",[l("ul",{staticClass:"filter"},[l("li",{staticClass:"item"},[l("i",[e._v("组名称：")]),l("Input",{staticClass:"fill",attrs:{placeholder:"请输入角色名称"},model:{value:e.condition.name,callback:function(t){e.$set(e.condition,"name",t)},expression:"condition.name"}})],1),l("li",{staticClass:"item"},[l("i",[e._v("类型：")]),l("Select",{staticClass:"fill",attrs:{transfer:"",clearable:""},model:{value:e.condition.type,callback:function(t){e.$set(e.condition,"type",t)},expression:"condition.type"}},e._l(e.dict.groupType,function(t,a){return l("Option",{key:a,attrs:{value:a}},[e._v(e._s(t))])}))],1),l("li",{staticClass:"item"},[l("i",[e._v("状态：")]),l("Select",{staticClass:"fill",attrs:{transfer:"",clearable:""},model:{value:e.condition.state,callback:function(t){e.$set(e.condition,"state",t)},expression:"condition.state"}},e._l(e.dict.state,function(t,a){return l("Option",{key:a,attrs:{value:a}},[e._v(e._s(t))])}))],1),l("li",{staticClass:"item"},[l("Button",{attrs:{type:"info",shape:"circle",icon:"md-search"},on:{click:e.search}},[e._v("查询")])],1),l("li",{staticClass:"item"},[l("Button",{attrs:{type:"primary",shape:"circle",icon:"md-add-circle"},on:{click:e.addRole}},[e._v("新增")])],1)]),l("Table",{attrs:{stripe:"",columns:e.table.columns,data:e.table.data,loading:e.table.loading}}),l("Page",{staticClass:"page-wrap",attrs:{total:e.table.total,current:e.table.current,"page-size":e.table.size,"show-total":""},on:{"on-change":e.changePage}}),l("Modal",{attrs:{title:e.roleModal.title,width:"800"},model:{value:e.roleModal.show,callback:function(t){e.$set(e.roleModal,"show",t)},expression:"roleModal.show"}},[l("Form",{ref:"roleForm",staticStyle:{width:"96%"},attrs:{model:e.roleModal.fields,rules:e.roleModal.roleValidate,"label-width":80}},[l("FormItem",{attrs:{label:"组名称",prop:"name"}},[l("Input",{attrs:{placeholder:"请输入"},model:{value:e.roleModal.fields.name,callback:function(t){e.$set(e.roleModal.fields,"name",t)},expression:"roleModal.fields.name"}})],1),l("FormItem",{attrs:{label:"唯一码",prop:"code"}},[l("Input",{attrs:{placeholder:"请输入"},model:{value:e.roleModal.fields.code,callback:function(t){e.$set(e.roleModal.fields,"code",t)},expression:"roleModal.fields.code"}})],1),l("FormItem",{attrs:{label:"类型",prop:"type"}},[l("Select",{attrs:{transfer:"",clearable:""},model:{value:e.roleModal.fields.type,callback:function(t){e.$set(e.roleModal.fields,"type",t)},expression:"roleModal.fields.type"}},e._l(e.dict.groupType,function(t,a){return l("Option",{key:a,attrs:{value:a}},[e._v(e._s(t))])}))],1),1===parseInt(e.roleModal.fields.type)?l("FormItem",{attrs:{label:"父节点",prop:"parentId"}},[l("Cascader",{attrs:{data:e.roleModal.roleList,value:e.roleModal.roleSelect,"change-on-select":""},on:{"on-change":e.changeRoleParent}})],1):e._e(),l("FormItem",{attrs:{label:"状态",prop:"state"}},[l("Select",{attrs:{transfer:"",clearable:""},model:{value:e.roleModal.fields.state,callback:function(t){e.$set(e.roleModal.fields,"state",t)},expression:"roleModal.fields.state"}},e._l(e.dict.state,function(t,a){return l("Option",{key:a,attrs:{value:a}},[e._v(e._s(t))])}))],1),l("FormItem",{attrs:{label:"文件夹标识",prop:"childNodeFlag"}},[l("Select",{attrs:{transfer:"",clearable:""},model:{value:e.roleModal.fields.childNodeFlag,callback:function(t){e.$set(e.roleModal.fields,"childNodeFlag",t)},expression:"roleModal.fields.childNodeFlag"}},e._l(e.roleModal.yOrN,function(t,a){return l("Option",{key:a,attrs:{value:a}},[e._v(e._s(t))])}))],1),l("FormItem",{attrs:{label:"排序",prop:"sort"}},[l("Input",{attrs:{number:"",placeholder:"请输入数字"},model:{value:e.roleModal.fields.sort,callback:function(t){e.$set(e.roleModal.fields,"sort",t)},expression:"roleModal.fields.sort"}})],1),l("FormItem",{attrs:{label:"描述",prop:"description"}},[l("Input",{attrs:{autosize:{minRows:2,maxRows:5},placeholder:"描述"},model:{value:e.roleModal.fields.description,callback:function(t){e.$set(e.roleModal.fields,"description",t)},expression:"roleModal.fields.description"}})],1)],1),l("div",{attrs:{slot:"footer"},slot:"footer"},[l("Button",{attrs:{type:"primary"},on:{click:e.saveRole}},[e._v("保存")]),l("Button",{on:{click:function(t){e.reset("roleForm",{state:"1"})}}},[e._v("重置")])],1)],1),l("Modal",{attrs:{title:e.resourceModal.title,closable:""},model:{value:e.resourceModal.show,callback:function(t){e.$set(e.resourceModal,"show",t)},expression:"resourceModal.show"}},[l("Tree",{ref:"resourceTree",staticStyle:{padding:"0 10px"},attrs:{data:e.resourceModal.data,multiple:"","show-checkbox":""},on:{"on-check-change":e.checkedResources}}),l("div",{staticClass:"modal-footer",attrs:{slot:"footer"},slot:"footer"},[l("Button",{attrs:{type:"success",disabled:!e.resourceModal.hasChanged},on:{click:e.saveResource}},[e._v("保存")]),l("Button",{attrs:{type:"primary"},on:{click:function(t){e.checkAll("resourceModal")}}},[e._v("全选")])],1)],1),l("Modal",{attrs:{title:e.fieldModal.title,closable:""},on:{"on-close":e.closeFieldModel},model:{value:e.fieldModal.show,callback:function(t){e.$set(e.fieldModal,"show",t)},expression:"fieldModal.show"}},[l("Tree",{ref:"fieldTree",staticStyle:{padding:"10px"},attrs:{data:e.fieldModal.data,multiple:"","show-checkbox":""},on:{"on-check-change":e.checkedField}}),l("div",{staticClass:"modal-footer",attrs:{slot:"footer"},slot:"footer"},[l("Button",{attrs:{type:"success",disabled:!e.fieldModal.hasChanged},on:{click:e.saveFields}},[e._v("保存")]),l("Button",{attrs:{type:"primary"},on:{click:function(t){e.checkAll("fieldModal")}}},[e._v("全选")])],1)],1)],1)},o=[],r=(l("7514"),l("55dd"),l("7f7f"),l("a481"),l("386d"),l("f751"),l("96cf"),l("3040")),s=l("c93e"),i=l("f121"),n=l("0db3"),c=l("e069"),d=l("bedf"),u={name:"Role",data:function(){var e=this;this.$createElement;return{condition:{name:null,type:null,state:null},dict:{groupType:i["c"].dict.groupType,state:i["c"].dict.state},table:{columns:[{type:"index",width:60,align:"center",title:"序号"},{title:"组名称",key:"name",align:"center"},{title:"组ID",key:"id",align:"center"},{title:"类型",key:"type",align:"center",render:function(e,t){var l=t.row;return e("div",[i["c"].dict.groupType[l.type]])}},{title:"状态",key:"stateValue",align:"center"},{title:"操作",key:"view",width:300,align:"center",render:function(t,l){var a=l.row,o={marginRight:"5px"},r=0===parseInt(a.type)?o:Object(s["a"])({},o,{display:"none"});return t("div",[t(c["Button"],{attrs:{type:"primary",size:"small"},style:o,on:{click:function(){e.edit(a.id)}}},["编辑"]),t(c["Button"],{attrs:{type:"success",size:"small"},style:r,on:{click:function(){e.showResourceModal(a,"1")}}},["资源授权"]),t(c["Button"],{attrs:{type:"info",size:"small"},style:r,on:{click:function(){e.showFieldModel(a)}}},["字段授权"]),t(c["Button"],{attrs:{type:"error",size:"small"},style:o,on:{click:function(){e.deleteRole(a)}}},["删除"])])}}],data:[],size:i["a"].pageSize,current:1,total:0,loading:!1},roleModal:{show:!1,edit:!1,title:null,roleList:[],roleFlat:[],roleSelect:[],fields:{id:null,name:null,code:null,description:null,state:null,childNodeFlag:null,parentId:null,type:null,sort:null},roleValidate:{name:i["c"].validate.required(),code:i["c"].validate.required(),type:i["c"].validate.required({trigger:"change"})},yOrN:i["c"].dict.yOrN},resourceModal:{show:!1,groupId:null,title:null,data:[],resources:[],hasChanged:!1},fieldModal:{show:!1,title:null,hasChanged:!1,data:[],groupId:null}}},components:{Tree:n["a"]},watch:{"roleModal.fields.type":function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(t){var l;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(0!==this.roleModal.roleList.length||1!=t){e.next=5;break}return e.next=3,this.$http({method:"post",url:i["c"].API.groupList,data:{type:1,state:1,pageSize:1e4}});case 3:l=e.sent,l.data.success&&(this.roleModal.roleFlat=l.data.result.list,this.roleModal.roleList=Object(d["c"])(l.data.result.list,{map:{id:"value",name:"label"}},"0"));case 5:1!=t&&(this.roleModal.fields.parentId=null);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},methods:{edit:function(e){var t=this;this.$http({method:"post",url:i["c"].API.groupGet,data:{id:e}}).then(function(e){var l=e.data;l.success?(Object.assign(t.roleModal,{show:!0,edit:!0,title:"编辑角色"}),t.roleModal.fields=l.result,window.setTimeout(t.findFullPath,100)):t.$Message.error("提交失败!"+l.error.errorMessage)})},search:function(){var e=this;this.table.loading=!0,this.$http({method:"post",url:i["c"].API.groupList,data:Object(s["a"])({},this.condition,{pageSize:this.table.size,pageNum:this.table.current})}).then(function(t){var l=t.data,a=l.result;e.table.loading=!1,l.success&&Object.assign(e.table,{total:a.total,current:a.pageNum,data:a.list})}).catch(function(t){e.$Message.error("系统异常，请刷新后重试！")})},changePage:function(e){this.table.current=e,this.search()},addRole:function(){Object.assign(this.roleModal,{title:"新增组",show:!0,edit:!1}),this.$refs.roleForm.resetFields(),Object.assign(this.roleModal.fields,{type:"0",state:"1"})},reset:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.$refs[e].resetFields();var l=e.replace("Form","Modal");this[l]&&Object.assign(this[l].fields,t)},changeRoleParent:function(e){e.length>0?this.roleModal.fields.parentId=e.pop():this.roleModal.fields.parentId=null},saveRole:function(){var e=this;this.$refs["roleForm"].validate(function(t){t?e.$http({method:"post",url:e.roleModal.edit?i["c"].API.groupUpdate:i["c"].API.groupSave,data:e.roleModal.fields}).then(function(t){var l=t.data;l.success?(e.$Message.success("提交成功!"),Object.assign(e.roleModal,{show:!1,edit:!1,title:null}),e.search()):e.$Message.error(l.error.errorMessage)}):e.$Message.error("请检查是否有未通过验证的字段!")})},deleteRole:function(e){var t=this;this.$Modal.confirm({title:"系统提示",content:"确定删除？",onOk:function(){t.$http({method:"post",url:i["c"].API.groupDelete,data:{id:e.id}}).then(function(e){var l=e.data;l.success?(t.$Message.success("删除成功!"),t.search()):t.$Message.error("刪除失败!"+l.error.errorMessage)}).catch(function(e){t.$Message.error("系统异常，请刷新后重试！")})}})},showResourceModal:function(e,t){var l=this;this.$http({method:"post",url:i["c"].API.groupResources,data:{groupId:e.id}}).then(function(t){var a=t.data;a.success&&a.result.length>0&&Object.assign(l.resourceModal,{show:!0,title:e.name+"资源授权",groupId:e.id,hasChanged:!1,data:a.result})}).catch(function(e){l.$Message.error("系统异常，请刷新后重试！")})},checkedResources:function(e){this.resourceModal.hasChanged=!0,this.resourceModal.resources=e},saveResource:function(){var e=this;this.$http({method:"post",url:i["c"].API.groupSaveResource,data:{groupId:this.resourceModal.groupId,resourceIds:this.$refs.resourceTree.getCheckedNodes().map(function(e){return e.id})}}).then(function(t){var l=t.data;l.success?(e.$Message.success("保存成功!"),Object.assign(e.resourceModal,{show:!1,hasChanged:!1})):e.$Message.error("保存失败!"+l.error.errorMessage)})},showFieldModel:function(e){var t=this;this.$http({method:"post",url:i["c"].API.groupField,data:{groupId:e.id}}).then(function(l){var a=l.data;if(a.success&&a.result.length>0){var o=a.result.map(function(e){return{name:e.alias,title:e.alias,checked:e.checked,fieldOrder:e.fieldOrder,id:e.id,parentId:e.parentId}});o.sort(function(e,t){return e.fieldOrder-t.fieldOrder}),Object.assign(t.fieldModal,{title:e.name+"字段授权",show:!0,data:o,groupId:e.id})}},function(e){t.$Message.error("请求失败，请稍候重试！")})},checkedField:function(e){this.fieldModal.hasChanged||(this.fieldModal.hasChanged=!0)},checkAll:function(e){this[e].hasChanged||(this[e].hasChanged=!0);var t=this[e].data.map(function(e){return e.checked=!0,e});this.$set(this[e],"data",t)},closeFieldModel:function(){Object.assign(this.fieldModal,{groupId:null,show:!1,hasChanged:!1})},saveFields:function(){var e=this,t=this.$refs.fieldTree.getCheckedNodes(),l=t.map(function(e){return e.id});this.$http({method:"post",url:i["c"].API.groupSaveField,data:{groupId:this.fieldModal.groupId,fieldIds:l}}).then(function(t){var l=t.data;l.success?e.$Message.success("保存成功！"):e.$Modal.error({title:"系统提示",content:"字段授权失败，请稍后重试！"})},function(t){e.Message.error("请求失败，请稍候重试！")}),this.closeFieldModel()},findFullPath:function(){var e=this;this.roleModal.roleSelect=[],this.roleModal.fields.parentId&&function(){var t=e.roleModal.fields.parentId,l=[];while("0"!=t){var a=e.roleModal.roleFlat.find(function(e){return e.id===t});a&&"0"!=t&&(l.unshift(t),t=a.parentId)}e.$nextTick(function(){this.roleModal.roleSelect=l})}()}},created:function(){this.search()}},h=u,f=l("2877"),p=Object(f["a"])(h,a,o,!1,null,null,null);p.options.__file="role.vue";t["default"]=p.exports}}]);