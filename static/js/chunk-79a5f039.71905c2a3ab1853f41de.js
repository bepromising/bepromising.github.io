(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-79a5f039"],{2877:function(e,t,o){"use strict";function a(e,t,o,a,l,r,s,n){var i,c="function"===typeof e?e.options:e;if(t&&(c.render=t,c.staticRenderFns=o,c._compiled=!0),a&&(c.functional=!0),r&&(c._scopeId="data-v-"+r),s?(i=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"===typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),l&&l.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(s)},c._ssrRegister=i):l&&(i=n?function(){l.call(this,this.$root.$options.shadowRoot)}:l),i)if(c.functional){c._injectStyles=i;var d=c.render;c.render=function(e,t){return i.call(t),d(e,t)}}else{var u=c.beforeCreate;c.beforeCreate=u?[].concat(u,i):[i]}return{exports:e,options:c}}o.d(t,"a",function(){return a})},"2f21":function(e,t,o){"use strict";var a=o("79e5");e.exports=function(e,t){return!!e&&a(function(){t?e.call(null,function(){},1):e.call(null)})}},"386d":function(e,t,o){o("214f")("search",1,function(e,t,o){return[function(o){"use strict";var a=e(this),l=void 0==o?void 0:o[t];return void 0!==l?l.call(o,a):new RegExp(o)[t](String(a))},o]})},4917:function(e,t,o){o("214f")("match",1,function(e,t,o){return[function(o){"use strict";var a=e(this),l=void 0==o?void 0:o[t];return void 0!==l?l.call(o,a):new RegExp(o)[t](String(a))},o]})},"55dd":function(e,t,o){"use strict";var a=o("5ca1"),l=o("d8e8"),r=o("4bf8"),s=o("79e5"),n=[].sort,i=[1,2,3];a(a.P+a.F*(s(function(){i.sort(void 0)})||!s(function(){i.sort(null)})||!o("2f21")(n)),"Array",{sort:function(e){return void 0===e?n.call(r(this)):n.call(r(this),l(e))}})},bedf:function(e,t,o){"use strict";o.d(t,"a",function(){return a}),o.d(t,"b",function(){return s}),o.d(t,"c",function(){return r}),o.d(t,"d",function(){return l});o("a481"),o("4917"),o("f751");var a=function(e){var t=JSON.stringify(e);return JSON.parse(t)},l=function e(t){for(var o,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"0",l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"parentId",r=[],s=0,n=t.length;s<n;s++)if(t[s][l]==a){var i=t[s];o=e(t,t[s].id,l),o.length>0&&(i.children=o),r.push(i)}return r},r=function e(t,o,a){for(var l,r=[],s=Object.assign({parentKey:"parentId",idKey:"id",childrenKey:"children"},o),n=0,i=t.length;n<i;n++)if(t[n][s.parentKey]==a){var c={};for(var d in s.map)c[s.map[d]]=t[n][d];l=e(t,o,t[n][s.idKey]),l.length>0&&(c[s.childrenKey]=l),r.push(c)}return r},s=function(e,t){var o=/\$\{\w+\}/,a=e.match(o);while(a){var l=a[0],r=t[l.replace(/\$\{(\w+)\}/,"$1")];e=e.replace(l,r),a=e.match(o)}return e}},f982:function(e,t,o){"use strict";o.r(t);var a=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("section",[o("ul",{staticClass:"filter"},[o("li",{staticClass:"item"},[o("i",[e._v("组名称：")]),o("Input",{staticClass:"fill",attrs:{placeholder:"请输入角色名称"},model:{value:e.condition.name,callback:function(t){e.$set(e.condition,"name",t)},expression:"condition.name"}})],1),o("li",{staticClass:"item"},[o("i",[e._v("类型：")]),o("Select",{staticClass:"fill",attrs:{transfer:"",clearable:""},model:{value:e.condition.type,callback:function(t){e.$set(e.condition,"type",t)},expression:"condition.type"}},e._l(e.dict.groupType,function(t,a){return o("Option",{key:a,attrs:{value:a}},[e._v(e._s(t))])}))],1),o("li",{staticClass:"item"},[o("i",[e._v("状态：")]),o("Select",{staticClass:"fill",attrs:{transfer:"",clearable:""},model:{value:e.condition.state,callback:function(t){e.$set(e.condition,"state",t)},expression:"condition.state"}},e._l(e.dict.state,function(t,a){return o("Option",{key:a,attrs:{value:a}},[e._v(e._s(t))])}))],1),o("li",{staticClass:"item"},[o("Button",{attrs:{type:"info",shape:"circle",icon:"md-search"},on:{click:e.search}},[e._v("查询")])],1),o("li",{staticClass:"item"},[o("Button",{attrs:{type:"primary",shape:"circle",icon:"md-add-circle"},on:{click:e.addRole}},[e._v("新增")])],1)]),o("Table",{attrs:{stripe:"",columns:e.table.columns,data:e.table.data,loading:e.table.loading}}),o("Page",{staticClass:"page-wrap",attrs:{total:e.table.total,current:e.table.current,"page-size":e.table.size,"show-total":""},on:{"on-change":e.changePage}}),o("Modal",{attrs:{title:e.roleModal.title,width:"800"},model:{value:e.roleModal.show,callback:function(t){e.$set(e.roleModal,"show",t)},expression:"roleModal.show"}},[o("Form",{ref:"roleForm",staticStyle:{width:"96%"},attrs:{model:e.roleModal.fields,rules:e.roleModal.roleValidate,"label-width":80}},[o("FormItem",{attrs:{label:"组名称",prop:"name"}},[o("Input",{attrs:{placeholder:"请输入"},model:{value:e.roleModal.fields.name,callback:function(t){e.$set(e.roleModal.fields,"name",t)},expression:"roleModal.fields.name"}})],1),o("FormItem",{attrs:{label:"唯一码",prop:"code"}},[o("Input",{attrs:{placeholder:"请输入"},model:{value:e.roleModal.fields.code,callback:function(t){e.$set(e.roleModal.fields,"code",t)},expression:"roleModal.fields.code"}})],1),o("FormItem",{attrs:{label:"类型",prop:"type"}},[o("Select",{attrs:{transfer:"",clearable:""},model:{value:e.roleModal.fields.type,callback:function(t){e.$set(e.roleModal.fields,"type",t)},expression:"roleModal.fields.type"}},e._l(e.dict.groupType,function(t,a){return o("Option",{key:a,attrs:{value:a}},[e._v(e._s(t))])}))],1),1===parseInt(e.roleModal.fields.type)?o("FormItem",{attrs:{label:"父节点",prop:"parentId"}},[o("Cascader",{attrs:{data:e.roleModal.roleList,value:e.roleModal.roleSelect,"change-on-select":""},on:{"on-change":e.changeRoleParent}})],1):e._e(),o("FormItem",{attrs:{label:"状态",prop:"state"}},[o("Select",{attrs:{transfer:"",clearable:""},model:{value:e.roleModal.fields.state,callback:function(t){e.$set(e.roleModal.fields,"state",t)},expression:"roleModal.fields.state"}},e._l(e.dict.state,function(t,a){return o("Option",{key:a,attrs:{value:a}},[e._v(e._s(t))])}))],1),o("FormItem",{attrs:{label:"文件夹标识",prop:"childNodeFlag"}},[o("Select",{attrs:{transfer:"",clearable:""},model:{value:e.roleModal.fields.childNodeFlag,callback:function(t){e.$set(e.roleModal.fields,"childNodeFlag",t)},expression:"roleModal.fields.childNodeFlag"}},e._l(e.roleModal.yOrN,function(t,a){return o("Option",{key:a,attrs:{value:a}},[e._v(e._s(t))])}))],1),o("FormItem",{attrs:{label:"排序",prop:"sort"}},[o("Input",{attrs:{number:"",placeholder:"请输入数字"},model:{value:e.roleModal.fields.sort,callback:function(t){e.$set(e.roleModal.fields,"sort",t)},expression:"roleModal.fields.sort"}})],1),o("FormItem",{attrs:{label:"描述",prop:"description"}},[o("Input",{attrs:{autosize:{minRows:2,maxRows:5},placeholder:"描述"},model:{value:e.roleModal.fields.description,callback:function(t){e.$set(e.roleModal.fields,"description",t)},expression:"roleModal.fields.description"}})],1)],1),o("div",{attrs:{slot:"footer"},slot:"footer"},[o("Button",{attrs:{type:"primary"},on:{click:e.saveRole}},[e._v("保存")]),o("Button",{on:{click:function(t){e.reset("roleForm",{state:"1"})}}},[e._v("重置")])],1)],1),o("Modal",{attrs:{title:e.resourceModal.title,closable:""},model:{value:e.resourceModal.show,callback:function(t){e.$set(e.resourceModal,"show",t)},expression:"resourceModal.show"}},[o("Tree",{ref:"resourceTree",staticStyle:{padding:"0 10px"},attrs:{data:e.resourceModal.data,multiple:"","show-checkbox":""},on:{"on-check-change":e.checkedResources}}),o("div",{staticClass:"modal-footer",attrs:{slot:"footer"},slot:"footer"},[o("Button",{attrs:{type:"success",disabled:!e.resourceModal.hasChanged},on:{click:e.saveResource}},[e._v("保存")]),o("Button",{attrs:{type:"primary"},on:{click:function(t){e.checkAll("resourceModal")}}},[e._v("全选")])],1)],1),o("Modal",{attrs:{title:e.fieldModal.title,closable:""},on:{"on-close":e.closeFieldModel},model:{value:e.fieldModal.show,callback:function(t){e.$set(e.fieldModal,"show",t)},expression:"fieldModal.show"}},[o("Tree",{ref:"fieldTree",staticStyle:{padding:"10px"},attrs:{data:e.fieldModal.data,multiple:"","show-checkbox":""},on:{"on-check-change":e.checkedField}}),o("div",{staticClass:"modal-footer",attrs:{slot:"footer"},slot:"footer"},[o("Button",{attrs:{type:"success",disabled:!e.fieldModal.hasChanged},on:{click:e.saveFields}},[e._v("保存")]),o("Button",{attrs:{type:"primary"},on:{click:function(t){e.checkAll("fieldModal")}}},[e._v("全选")])],1)],1)],1)},l=[],r=(o("7514"),o("55dd"),o("7f7f"),o("a481"),o("386d"),o("f751"),o("96cf"),o("3040")),s=o("c93e"),n=o("f121"),i=o("0db3"),c=o("e069"),d=o("bedf"),u={name:"Role",data:function(){var e=this;this.$createElement;return{condition:{name:null,type:null,state:null},dict:{groupType:n["c"].dict.groupType,state:n["c"].dict.state},table:{columns:[{type:"index",width:60,align:"center",title:"序号"},{title:"组名称",key:"name",align:"center"},{title:"组ID",key:"id",align:"center"},{title:"类型",key:"type",align:"center",render:function(e,t){var o=t.row;return e("div",[n["c"].dict.groupType[o.type]])}},{title:"状态",key:"stateValue",align:"center"},{title:"操作",key:"view",width:300,align:"center",render:function(t,o){var a=o.row,l={marginRight:"5px"},r=0===parseInt(a.type)?l:Object(s["a"])({},l,{display:"none"});return t("div",[t(c["Button"],{attrs:{type:"primary",size:"small"},style:l,on:{click:function(){e.edit(a.id)}}},["编辑"]),t(c["Button"],{attrs:{type:"success",size:"small"},style:r,on:{click:function(){e.showResourceModal(a,"1")}}},["资源授权"]),t(c["Button"],{attrs:{type:"info",size:"small"},style:r,on:{click:function(){e.showFieldModel(a)}}},["字段授权"]),t(c["Button"],{attrs:{type:"error",size:"small"},style:l,on:{click:function(){e.deleteRole(a)}}},["删除"])])}}],data:[],size:n["a"].pageSize,current:1,total:0,loading:!1},roleModal:{show:!1,edit:!1,title:null,roleList:[],roleFlat:[],roleSelect:[],fields:{id:null,name:null,code:null,description:null,state:null,childNodeFlag:null,parentId:null,type:null,sort:null},roleValidate:{name:n["c"].validate.required(),code:n["c"].validate.required(),type:n["c"].validate.required({trigger:"change"})},yOrN:n["c"].dict.yOrN},resourceModal:{show:!1,groupId:null,title:null,data:[],resources:[],hasChanged:!1},fieldModal:{show:!1,title:null,hasChanged:!1,data:[],groupId:null}}},components:{Tree:i["a"]},watch:{"roleModal.fields.type":function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(t){var o;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(0!==this.roleModal.roleList.length||1!=t){e.next=5;break}return e.next=3,this.$http({method:"post",url:n["c"].API.groupList,data:{type:1,state:1,pageSize:1e4}});case 3:o=e.sent,o.data.success&&(this.roleModal.roleFlat=o.data.result.list,this.roleModal.roleList=Object(d["c"])(o.data.result.list,{map:{id:"value",name:"label"}},"0"));case 5:1!=t&&(this.roleModal.fields.parentId=null);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},methods:{edit:function(e){var t=this;this.$http({method:"post",url:n["c"].API.groupGet,data:{id:e}}).then(function(e){var o=e.data;o.success?(Object.assign(t.roleModal,{show:!0,edit:!0,title:"编辑角色"}),t.roleModal.fields=o.result,window.setTimeout(t.findFullPath,100)):t.$Message.error("提交失败!"+o.error.errorMessage)})},search:function(){var e=this;this.table.loading=!0,this.$http({method:"post",url:n["c"].API.groupList,data:Object(s["a"])({},this.condition,{pageSize:this.table.size,pageNum:this.table.current})}).then(function(t){var o=t.data,a=o.result;e.table.loading=!1,o.success&&Object.assign(e.table,{total:a.total,current:a.pageNum,data:a.list})}).catch(function(t){e.$Message.error("系统异常，请刷新后重试！")})},changePage:function(e){this.table.current=e,this.search()},addRole:function(){Object.assign(this.roleModal,{title:"新增组",show:!0,edit:!1}),this.$refs.roleForm.resetFields(),Object.assign(this.roleModal.fields,{type:"0",state:"1"})},reset:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.$refs[e].resetFields();var o=e.replace("Form","Modal");this[o]&&Object.assign(this[o].fields,t)},changeRoleParent:function(e){e.length>0?this.roleModal.fields.parentId=e.pop():this.roleModal.fields.parentId=null},saveRole:function(){var e=this;this.$refs["roleForm"].validate(function(t){t?e.$http({method:"post",url:e.roleModal.edit?n["c"].API.groupUpdate:n["c"].API.groupSave,data:e.roleModal.fields}).then(function(t){var o=t.data;o.success?(e.$Message.success("提交成功!"),Object.assign(e.roleModal,{show:!1,edit:!1,title:null}),e.search()):e.$Message.error(o.error.errorMessage)}):e.$Message.error("请检查是否有未通过验证的字段!")})},deleteRole:function(e){var t=this;this.$Modal.confirm({title:"系统提示",content:"确定删除？",onOk:function(){t.$http({method:"post",url:n["c"].API.groupDelete,data:{id:e.id}}).then(function(e){var o=e.data;o.success?(t.$Message.success("删除成功!"),t.search()):t.$Message.error("刪除失败!"+o.error.errorMessage)}).catch(function(e){t.$Message.error("系统异常，请刷新后重试！")})}})},showResourceModal:function(e,t){var o=this;this.$http({method:"post",url:n["c"].API.groupResources,data:{groupId:e.id}}).then(function(t){var a=t.data;a.success&&a.result.length>0&&Object.assign(o.resourceModal,{show:!0,title:e.name+"资源授权",groupId:e.id,hasChanged:!1,data:a.result})}).catch(function(e){o.$Message.error("系统异常，请刷新后重试！")})},checkedResources:function(e){this.resourceModal.hasChanged=!0,this.resourceModal.resources=e},saveResource:function(){var e=this;this.$http({method:"post",url:n["c"].API.groupSaveResource,data:{groupId:this.resourceModal.groupId,resourceIds:this.$refs.resourceTree.getCheckedNodes().map(function(e){return e.id})}}).then(function(t){var o=t.data;o.success?(e.$Message.success("保存成功!"),Object.assign(e.resourceModal,{show:!1,hasChanged:!1})):e.$Message.error("保存失败!"+o.error.errorMessage)})},showFieldModel:function(e){var t=this;this.$http({method:"post",url:n["c"].API.groupField,data:{groupId:e.id}}).then(function(o){var a=o.data;if(a.success&&a.result.length>0){var l=a.result.map(function(e){return{name:e.alias,title:e.alias,checked:e.checked,fieldOrder:e.fieldOrder,id:e.id,parentId:e.parentId}});l.sort(function(e,t){return e.fieldOrder-t.fieldOrder}),Object.assign(t.fieldModal,{title:e.name+"字段授权",show:!0,data:l,groupId:e.id})}},function(e){t.$Message.error("请求失败，请稍候重试！")})},checkedField:function(e){this.fieldModal.hasChanged||(this.fieldModal.hasChanged=!0)},checkAll:function(e){this[e].hasChanged||(this[e].hasChanged=!0);var t=this[e].data.map(function(e){return e.checked=!0,e});this.$set(this[e],"data",t)},closeFieldModel:function(){Object.assign(this.fieldModal,{groupId:null,show:!1,hasChanged:!1})},saveFields:function(){var e=this,t=this.$refs.fieldTree.getCheckedNodes(),o=t.map(function(e){return e.id});this.$http({method:"post",url:n["c"].API.groupSaveField,data:{groupId:this.fieldModal.groupId,fieldIds:o}}).then(function(t){var o=t.data;o.success?e.$Message.success("保存成功！"):e.$Modal.error({title:"系统提示",content:"字段授权失败，请稍后重试！"})},function(t){e.Message.error("请求失败，请稍候重试！")}),this.closeFieldModel()},findFullPath:function(){var e=this;this.roleModal.roleSelect=[],this.roleModal.fields.parentId&&function(){var t=e.roleModal.fields.parentId,o=[];while("0"!=t){var a=e.roleModal.roleFlat.find(function(e){return e.id===t});a&&"0"!=t&&(o.unshift(t),t=a.parentId)}e.$nextTick(function(){this.roleModal.roleSelect=o})}()}},created:function(){this.search()}},h=u,f=o("2877"),p=Object(f["a"])(h,a,l,!1,null,null,null);p.options.__file="role.vue";t["default"]=p.exports}}]);